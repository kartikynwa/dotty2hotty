#!/bin/bash

maxlen=41

if [ ! -x /usr/bin/mpc ];
then
  echo "mpc is not installed."
  exit
fi

output=$( mpc -f "\"%title%\" by %artist%\t%file%" )

if [ -z "$output" ]
then
  echo "mpd down"
  exit
fi

if [ $( echo "$output" | wc -l ) -eq 1 ]
then
  echo "mpd queue empty"
  exit
fi

ashuffle=""
if [ "$(pgrep -x ashuffle)" ]
then
  ashuffle=" <ash>"
fi

song_info=$( echo "$output" | head -1 | awk -F"\t" '{ print $1 }' )
if [ -z "$song_info" ]
then
  song_info=$( echo "$output" | head -1 | awk -F"\t" '{ print $2 }' )
fi

# Splice output if it is too long
if [ ${#song_info} -ge ${maxlen} ]
then
  song_info="$( echo $song_info | colrm ${maxlen} )â€¦"
fi

vol=$( echo "$output" | sed -n "3p" | cut -c 8-11 | tr -d '[:space:]' )

# Echo the crap of out it
if [ -n "$song_info" ]; then
  echo "${song_info} <${vol}>${ashuffle}"
fi
